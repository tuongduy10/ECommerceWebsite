@using Microsoft.Extensions.Configuration
@inject IConfiguration Configuration
@{
    Layout = "~/Views/Shared/_LayoutAdmin.cshtml";
}

<!-- Begin Page Content -->
<div class="container-fluid">
    <!-- DataTales Example -->
    <div class="card shadow mb-4">
        <div class="card-header py-3">
            <h6 class="m-0 font-weight-bold text-primary text-center">Thêm sản phẩm</h6>
        </div>
        <div class="card-body p-2">
            <form class="mx-auto">
                <div class="row">
                    <div class="col-sm-6 mb-4">
                        <div class="text-left mb-2 text-primary"><strong>1. Thông tin cơ bản</strong></div>
                        <div class="form-group mb-4">
                            <label>Tên sản phẩm</label>
                            <input type="text" class="form-control" value="">
                        </div>
                        <div class="form-group mb-4">
                            <label>Giá có sẵn</label>
                            <div class="d-flex align-items-center">
                                <input type="number" class="form-control" value="" min="0" step="1000">
                            </div>
                        </div>
                        <div class="form-group mb-4">
                            <label>Giá đặt trước</label>
                            <div class="d-flex align-items-center">
                                <input type="number" class="form-control" value="" min="0" step="1000">
                            </div>
                        </div>
                        <div class="form-group mb-4">
                            <label>Giảm giá</label>
                            <div class="form-check mb-4">
                                <input class="form-check-input" type="radio" name="flexRadioDefault" id="flexRadioDefault1">
                                <label class="form-check-label" for="flexRadioDefault1">
                                    Giảm theo %
                                </label>
                                <input type="number" class="form-control mb-2 d-none" placeholder="% giảm" value="" min="0" step="1000">
                            </div>
                            <div class="form-check mb-4">
                                <input class="form-check-input" type="radio" name="flexRadioDefault" id="flexRadioDefault2">
                                <label class="form-check-label" for="flexRadioDefault2">
                                    Giảm theo giá
                                </label>
                                <input type="number" class="form-control mb-2 d-none" placeholder="Giá giảm có sẵn" value="" min="0" step="1000">
                                <input type="number" class="form-control mb-2 d-none" placeholder="Giá giảm đặt trước" value="" min="0" step="1000">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Thương hiệu</label>
                            <div class="select-form w-100 mb-2">
                                <div class="dropdown">
                                    <button class="btn border dropdown-toggle" type="button" data-toggle="dropdown">
                                        Thương hiệu
                                        <span class="caret"></span>
                                    </button>
                                    <ul class="dropdown-menu px-2" style="max-height: 300px; overflow-y: auto">
                                        <input class="form-control mb-2" id="myInput" type="text" placeholder="Tìm..." autocomplete="off">
                                        @foreach (var brand in Model)
                                        {
                                            <li>
                                                <div>
                                                    <input name="brand" class="mr-1" id="@brand.BrandId" type="radio" onclick="getSubCategory(@brand.BrandId)">
                                                    <label for="@brand.BrandId">@brand.BrandName</label>
                                                </div>
                                            </li>
                                        }
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="form-group subcategory-form">
                            <!--Subcategory-->

                        </div>
                    </div>
                    <div class="col-sm-6 mb-4">
                        <div class="options-form">
                            <!--Options-->
                            
                        </div>
                        <div class="form-group mb-4">
                            <label>Hướng dẫn chọn kích thước</label>
                            <div class="d-flex flex-wrap">
                                <div class="">
                                    <div class="border" style="height: 100px; width: 100px;">
                                        <label class="mb-0 w-100 h-100 d-flex align-items-center justify-content-center"
                                               for="pic-size" style="cursor: pointer">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="24"
                                                 height="24" viewBox="0 0 24 24" fill="none"
                                                 stroke="#ddd" stroke-width="1" stroke-linecap="round"
                                                 stroke-linejoin="round"
                                                 class="feather feather-plus-circle">
                                                <circle cx="12" cy="12" r="10"></circle>
                                                <line x1="12" y1="8" x2="12" y2="16"></line>
                                                <line x1="8" y1="12" x2="16" y2="12"></line>
                                            </svg>
                                        </label>
                                        <input type="file" class="form-control-file image-uploaded"
                                               id="pic-size" hidden>
                                        <div class="image-wrapper w-100 h-100 position-relative d-none align-items-center justify-content-center">
                                            <img class="mw-100 mh-100"
                                                 src="../assets/images/products/pro1.png" alt="">
                                            <span class="position-absolute remove-upload"
                                                  style="right: 0; top: 0; cursor: pointer;">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="18"
                                                     height="18" viewBox="0 0 24 24" fill="none"
                                                     stroke="red" stroke-width="1" stroke-linecap="round"
                                                     stroke-linejoin="round" class="feather feather-x">
                                                    <line x1="18" y1="6" x2="6" y2="18"></line>
                                                    <line x1="6" y1="6" x2="18" y2="18"></line>
                                                </svg>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                         
                        <div class="attributes-form">
                            <!--Attributes-->
                        </div>
                    </div>
                    <div class="col-sm-12 mb-4">
                        <div class="text-left mb-2 text-primary"><strong>4. Mô tả</strong></div>
                        <div class="form-group mb-4">
                            <textarea class="form-control" id="product-desciptions" rows="8"
                                      cols="50"></textarea>
                        </div>
                        <div class="mb-2 text-primary"><strong>Ảnh sản phẩm</strong></div>
                        <div class="form-group mb-4">
                            <label for="imageProduct-upload" class="input-tile mb-2">
                                <div class="d-flex">
                                    <a class="upload">Chọn ảnh</a>
                                    <div>(*Tối đa 10, tối thiểu 1)</div>
                                </div>
                            </label>
                            <input id="imageProduct-upload" type="file" multiple hidden />
                            <output class="d-flex flex-wrap" id="imageProduct-preview">
                            </output>
                        </div>
                        <div class="mb-2 text-primary"><strong>Ảnh thực tế</strong></div>
                        <div class="form-group mb-4">
                            <label for="imageUser-upload" class="input-tile mb-2">
                                <div class="d-flex">
                                    <a class="upload">Chọn ảnh</a>
                                    <div>(Tối đa 10, nếu có)</div>
                                </div>
                            </label>
                            <input id="imageUser-upload" type="file" multiple hidden />
                            <output class="d-flex flex-wrap" id="imageUser-preview">
                            </output>
                        </div>
                    </div>
                </div>
                <div class="text-center">
                    <button class="btn btn-secondary">Hủy</button>
                    <button class="btn btn-primary">Lưu</button>
                </div>
            </form>
        </div>
    </div>
</div>
<!-- /.container-fluid -->
<script>
    function getSubCategory(id) {
        $.get('/api/CategoryAPI/getSubCategoryByBrandId', { id: id }, function (data) {
            $('.subcategory-form').empty();
            $('.subcategory-form').append(`
                <label>Danh mục sản phẩm</label>
                <div class="select-form w-100 mb-2">
                    <select name="" id="_subc-select" class="subc-select form-control" onchange="renderAttributesAndOptions(this)">
                        <option value="" disabled selected>--Chọn--</option>
                    </select>
                </div>
            `);
            for (var i = 0; i < data.length; i++) {
                $('.subc-select').append(`
                    <option value="${data[i].subCategoryId}">${data[i].subCategoryName}</option>
                `);
            }
        })
    }
    function renderAttributesAndOptions(element) {
        getOptions($(element).val());
        getAttributes($(element).val());
    }
    function getOptions(id) {
        $.get('/api/CategoryAPI/getOptionsBySubCategoryId', { id: id }, function (data) {
            console.log('option----', data)
            $('.options-form').empty();
            if (data.length > 0) {
                $('.options-form').append(`
                    <div class="text-left mb-2 text-primary"><strong>2. Thông tin tùy chọn</strong></div>
                    <div class="d-flex flex-wrap options">
                   
                    </div>
                `);
                for (var i = 0; i < data.length; i++) {
                    $('.options').append(`
                    <div class="form-group mr-4 mb-2">
                        <label>${data[i]}</label>
                        <div class="d-flex mb-2">
                            <div class="dropdown mr-2">
                                <input class="form-control" type="text">
                            </div>
                            <a class="add-option btn btn-primary" onclick="addOptions(this)">Thêm</a>
                        </div>
                        <ul class="pl-0">
                        </ul>
                    </div>
                `);
                }
            }
        })
    }
    function getAttributes(id) {
        $.get('/api/CategoryAPI/getAttributesBySubCategoryId', { id: id }, function (data) {
            console.log('attr----',data)
            $('.attributes-form').empty();
            if (data.length > 0) {
                $('.attributes-from').append(`
                    <div class="text-left mb-2 text-primary"><strong>3. Thông tin chi tiết</strong></div>
                    <div class="d-flex flex-wrap attributes">
                    
                    </div>
                `);
                for (var i = 0; i < data.length; i++) {
                    $('.attributes').append(`
                    <div class="form-group mr-2">
                        <label>${data[i]}</label>
                        <input type="text" class="form-control">
                    </div>
                `);
                }
            }
        })
    }
</script>

<script src="https://cdn.tiny.cloud/1/4ctr9pi6o8mlflu8si6gdszgl62tn4zl73knhf3tkqalszsx/tinymce/6/tinymce.min.js" referrerpolicy="origin"></script>
<script>
    tinymce.init({
        selector: 'textarea',
        plugins: 'a11ychecker advcode casechange export formatpainter image editimage linkchecker autolink lists checklist media mediaembed pageembed permanentpen powerpaste table advtable tableofcontents tinycomments tinymcespellchecker',
        toolbar: 'a11ycheck addcomment showcomments casechange checklist code export formatpainter image editimage pageembed permanentpen table tableofcontents',
        toolbar_mode: 'floating',
        tinycomments_mode: 'embedded',
        tinycomments_author: 'Author name',
    });
</script>
<script type="text/javascript">
    $(document).ready(function () {
        $("#myInput").on("keyup", function () {
            var value = $(this).val().toLowerCase();
            $(".dropdown-menu li").filter(function () {
                $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
            });
        });
    });
</script>
<script type="text/javascript">
    $('.image-uploaded').change(function () {
        // Set image src
        let src = window.URL.createObjectURL(this.files[0]);
        $(this).siblings('.image-wrapper').children('img').attr('src', src);
        // hide label
        $(this).siblings('label').removeClass('d-flex');
        $(this).siblings('label').addClass('d-none');
        // display image
        $(this).siblings('.image-wrapper').removeClass('d-none');
        $(this).siblings('.image-wrapper').addClass('d-flex');
    })
    $('.remove-upload').click(function () {
        // Remove Image
        $(this).siblings('img').attr('src', '');
        // Hide image wrapper
        $(this).parent().removeClass('d-flex');
        $(this).parent().addClass('d-none');
        // Display label
        $(this).parent().siblings('label').removeClass('d-none');
        $(this).parent().siblings('label').addClass('d-flex');
    })
</script>
<script type="text/javascript">
    function addOptions(element) {
        let val = $(element).siblings('.dropdown').find('input').val();
        if (!val?.trim()) { return; }

        $(element).parent().siblings('ul').append(`
            <li class="d-inline p-1 mr-2 mb-2"
                style="background-color: #ddd; border-radius: 4px;">
                <span class="text">${val}</span>
                <span class="remove-tag ml-2" style="cursor: pointer;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                        viewBox="0 0 24 24" fill="none" stroke="#333"
                        stroke-width="1" stroke-linecap="round"
                        stroke-linejoin="round" class="feather feather-x">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </span>
            </li>
        `)

        $(element).siblings('.dropdown').find('input').val('');
    }

    $('.form-check-input').change(function () {
        $('.form-check-input').siblings('input').addClass('d-none');
        if ($(this).is(':checked')) {
            $(this).siblings('input').removeClass('d-none');
        }
    })
</script>
<script type="text/javascript">
    // Remove current banner
    $('.remove-tag').click(function () {
        $(this).parent().remove();
    })
    // Remove new added banner
    $(document).on('click', ".remove-tag", function () {
        $(this).parent().remove();
    });

    window.onload = function () {
        loadIamgesWithPreview("imageProduct-upload", "imageProduct-preview");
        loadIamgesWithPreview("imageUser-upload", "imageUser-preview");
        function loadIamgesWithPreview(upload, preview) {
            if (window.File && window.FileList && window.FileReader) {
                var filesInput = document.getElementById(upload);
                filesInput.addEventListener("change", function (event) {
                    var files = event.target.files; //FileList object
                    var currentFiles = $('.image__upload-item').length + files.length
                    if (currentFiles > 10) {
                        return;
                    }
                    var output = document.getElementById(preview);
                    for (var i = 0; i < files.length; i++) {
                        var file = files[i];
                        //Only pics
                        if (!file.type.match('image'))
                            continue;
                        var picReader = new FileReader();
                        picReader.addEventListener("load", function (event) {
                            var picFile = event.target;
                            var div = document.createElement("div");
                            div.classList.add(`image__upload-item`, `mr-2`);
                            div.innerHTML = `
                                <div class="border mb-2 mx-auto" style="height: 100px; width: 100px;">
                                    <div class="image-wrapper w-100 h-100 position-relative d-flex align-items-center justify-content-center">
                                        <img class="mw-100 mh-100" src="${picFile.result}" alt="${picFile.name}">
                                        <span class="position-absolute remove-upload"
                                            style="right: 0; top: 0; cursor: pointer;">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="18"
                                                height="18" viewBox="0 0 24 24" fill="none"
                                                stroke="red" stroke-width="1" stroke-linecap="round"
                                                stroke-linejoin="round" class="feather feather-x">
                                                <line x1="18" y1="6" x2="6" y2="18"></line>
                                                <line x1="6" y1="6" x2="18" y2="18"></line>
                                            </svg>
                                        </span>
                                    </div>
                                </div>
                            `;
                            var removeUpload = div.querySelector(".remove-upload");
                            removeUpload.addEventListener("click", function (evt) {
                                div.remove();
                            })
                            output.insertBefore(div, null);
                        });
                        //Read the image
                        picReader.readAsDataURL(file);
                    }
                });
            }
        }
    }
</script>