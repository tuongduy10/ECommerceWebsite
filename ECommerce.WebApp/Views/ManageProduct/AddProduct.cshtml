@using Microsoft.Extensions.Configuration
@inject IConfiguration Configuration
@{
    Layout = "~/Views/Shared/_LayoutAdmin.cshtml";
}
<script src="https://cdn.tiny.cloud/1/4ctr9pi6o8mlflu8si6gdszgl62tn4zl73knhf3tkqalszsx/tinymce/6/tinymce.min.js" referrerpolicy="origin"></script>
<div class="container-fluid">
    <!-- DataTales Example -->
    <div class="card shadow mb-4">
        <div class="card-header py-3">
            <h6 class="m-0 font-weight-bold text-primary text-center">Thêm sản phẩm</h6>
        </div>
        <div class="card-body p-2">
            <form class="mx-auto">
                <div class="row">
                    <div class="col-sm-6 mb-4">
                        <div class="text-left mb-2 text-primary"><strong>Thông tin cơ bản</strong></div>
                        <!-- Code -->
                        <div class="form-group mb-4">
                            <label>Mã sản phẩm</label>
                            <input type="text" class="form-control pro-code" value="">
                        </div>
                        <!-- Name -->
                        <div class="form-group mb-4">
                            <label>Tên sản phẩm</label>
                            <input type="text" class="form-control pro-name" value="">
                        </div>
                        <!-- Stock -->
                        <div class="form-group mb-4">
                            <label>Số lượng trong kho</label>
                            <input type="number" class="form-control pro-stock" value="">
                        </div>
                        <!-- Price -->
                        <div class="form-group mb-4">
                            <label>Giá có sẵn</label>
                            <div class="d-flex align-items-center">
                                <input type="number" class="form-control pro-priceavailable" value="" min="0" step="1000" id="1">
                            </div>
                        </div>
                        <div class="form-group mb-4">
                            <label>Giá đặt trước</label>
                            <div class="d-flex align-items-center">
                                <input type="number" class="form-control pro-pricepreorder" value="" min="0" step="1000" id="2">
                            </div>
                        </div>
                        <!-- Discount -->
                        <div class="form-group mb-4">
                            <label>Giảm giá</label>
                            <div class="form-check mb-4">
                                <input class="form-check-input pro-discpercent-select" type="radio" name="flexRadioDefault" id="flexRadioDefault1">
                                <label class="form-check-label" for="flexRadioDefault1">
                                    Giảm theo %
                                </label>
                                <input type="number" class="form-control mb-2 d-none pro-discpercent" placeholder="% giảm" value="" min="0" max="100">
                            </div>
                            <div class="form-check mb-4">
                                <input class="form-check-input pro-disc-select" type="radio" name="flexRadioDefault" id="flexRadioDefault2">
                                <label class="form-check-label" for="flexRadioDefault2">
                                    Giảm theo giá
                                </label>
                                <input type="number" class="form-control mb-2 d-none pro-discavailable" placeholder="Giá đã giảm có sẵn" value="" min="0" step="1000" id="1">
                                <input type="number" class="form-control mb-2 d-none pro-discpreorder" placeholder="Giá đã giảm đặt trước" value="" min="0" step="1000" id="2">
                            </div>
                        </div>
                        <!-- New -->
                        <div class="form-group mb-4">
                            <div class="d-flex align-items-center">
                                <input type="checkbox" class="pro-new mr-2" id="new">
                                <label class="mb-0" for="new">Mới</label>
                            </div>
                        </div>
                        <!-- Legit -->
                        <div class="form-group mb-4">
                            <div class="d-flex align-items-center">
                                <input type="checkbox" class="pro-legit mr-2" id="legit">
                                <label class="mb-0" for="legit">Chính hãng</label>
                            </div>
                        </div>
                        <!-- Highlight -->
                        <div class="form-group mb-4">
                            <div class="d-flex align-items-center">
                                <input type="checkbox" class="pro-highlight mr-2" id="highlight">
                                <label class="mb-0" for="highlight">Nổi bật</label>
                            </div>
                        </div>
                        <!-- Free return -->
                        <div class="form-group mb-4">
                            <div class="d-flex align-items-center">
                                <input type="checkbox" class="pro-freereturn mr-2" id="return">
                                <label class="mb-0" for="return">Miễn phí giao hàng</label>
                            </div>
                        </div>
                        <!-- Free delivery -->
                        <div class="form-group mb-4">
                            <div class="d-flex align-items-center">
                                <input type="checkbox" class="pro-freedelivery mr-2" id="delivery">
                                <label class="mb-0" for="delivery">Đổi trả miễn phí</label>
                            </div>
                        </div>
                        <!-- Insurance -->
                        <div class="form-group mb-4">
                            <label class="required">Bảo hành</label>
                            <div class="d-flex align-items-center">
                                <input type="text" class="form-control pro-insurance">
                            </div>
                        </div>
                        <!-- Shop -->
                        <div class="form-group mb-4">
                            <label>Cửa hàng</label>
                            <div class="dropdown mb-2 mr-2">
                                <button class="btn border dropdown-toggle shop_select-text" type="button" data-toggle="dropdown">
                                    Cửa hàng
                                    <span class="caret"></span>
                                </button>
                                <ul class="dropdown-menu dropdown-sh-menu px-2" style="max-height: 300px; overflow: auto;">
                                    <input class="form-control mb-2" id="myInput-sh" type="text" placeholder="Tìm cửa hàng..." autocomplete="off" />
                                    @foreach (var item in Model.shops)
                                    {
                                        <li class="d-flex align-items-center" value="@item.ShopName">
                                            <input name="shop" class="shop_select mr-2" id="sh_@item.ShopId" type="radio" value="@item.ShopId">
                                            <label class="mb-0" for="sh_@item.ShopId">@item.ShopName</label>
                                        </li>
                                    }
                                </ul>
                            </div>
                        </div>
                        <div class="form-group mb-4 brand-form">
                            <!-- Brand data -->
                        </div>
                        <div class="form-group subcategory-form">
                            <!-- SubCategory data -->
                        </div>
                    </div>
                    <div class="col-sm-6 mb-4">
                        <div class="attribute-form">
                            <!-- Attributes -->
                        </div>
                        <div class="option-form">
                            <!-- Options -->
                        </div>
                        <!-- Size guide -->
                        @*<div class="form-group mb-4">
                                <label>Hướng dẫn chọn kích thước</label>
                                <div class="d-flex flex-wrap">
                                    <div class="">
                                        <div class="border" style="height: 100px; width: 100px;">
                                            <label class="mb-0 w-100 h-100 d-flex align-items-center justify-content-center"
                                                   for="pic-size" style="cursor: pointer">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="24"
                                                     height="24" viewBox="0 0 24 24" fill="none"
                                                     stroke="#ddd" stroke-width="1" stroke-linecap="round"
                                                     stroke-linejoin="round"
                                                     class="feather feather-plus-circle">
                                                    <circle cx="12" cy="12" r="10"></circle>
                                                    <line x1="12" y1="8" x2="12" y2="16"></line>
                                                    <line x1="8" y1="12" x2="16" y2="12"></line>
                                                </svg>
                                            </label>
                                            <input type="file" class="form-control-file image-uploaded"
                                                   id="pic-size" hidden>
                                            <div class="image-wrapper w-100 h-100 position-relative d-none align-items-center justify-content-center">
                                                <img class="mw-100 mh-100"
                                                     src="../assets/images/products/pro1.png" alt="">
                                                <span class="position-absolute remove-upload"
                                                      style="right: 0; top: 0; cursor: pointer;">
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="18"
                                                         height="18" viewBox="0 0 24 24" fill="none"
                                                         stroke="red" stroke-width="1" stroke-linecap="round"
                                                         stroke-linejoin="round" class="feather feather-x">
                                                        <line x1="18" y1="6" x2="6" y2="18"></line>
                                                        <line x1="6" y1="6" x2="18" y2="18"></line>
                                                    </svg>
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>*@
                    </div>
                    <div class="col-sm-12 mb-4">
                        <!-- Description -->
                        <div class="text-left mb-2 text-primary"><strong>Mô tả</strong></div>
                        <div class="form-group mb-4">
                            <textarea class="form-control" id="product-desciptions" rows="8"
                                      cols="50"></textarea>
                        </div>
                        <!-- Size Guide -->
                        <div class="text-left mb-2 text-primary">
                            <strong>Hướng dẫn chọn size</strong>
                            <div class="form-group">
                                <div class="dropdown mb-2 mr-2">
                                    <button class="btn border dropdown-toggle size_select-text" type="button" data-toggle="dropdown">
                                        Chọn size theo loại
                                        <span class="caret"></span>
                                    </button>
                                    <ul class="dropdown-menu dropdown-size-menu px-2" style="max-height: 300px; overflow: auto;">
                                        <input class="form-control mb-2" id="myInput-size" type="text" placeholder="Tìm..." autocomplete="off" />
                                        @foreach (var item in Model.subCategories)
                                        {
                                            @if (item.SizeGuide != null)
                                            {
                                                <li class="d-flex align-items-center" value="@item.SubCategoryId">
                                                    <input name="size" class="size_select mr-2" id="size_@item.SubCategoryId" type="radio" value="@item.SubCategoryId" onclick="getSize(@item.SubCategoryId)">
                                                    <label class="mb-0" for="size_@item.SubCategoryId">@item.SubCategoryName</label>
                                                </li>
                                            }
                                        }
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="form-group mb-4">
                            <textarea class="form-control" id="product-sizeguide" rows="8"
                                      cols="50"></textarea>
                        </div>
                        <!-- System's images -->
                        <div class="mb-2 text-primary"><strong>Ảnh sản phẩm</strong></div>
                        <div class="form-group mb-4">
                            <label for="imageProduct-upload" class="input-tile mb-2">
                                <div class="d-flex">
                                    <a class="upload mr-2">Chọn ảnh</a>
                                    <div>(*Tối đa 10, tối thiểu 1)</div>
                                </div>
                            </label>
                            <input id="imageProduct-upload" type="file" multiple hidden />
                            <output class="d-flex flex-wrap" id="imageProduct-preview">
                            </output>
                        </div>
                        <!-- User's images -->
                        <div class="mb-2 text-primary"><strong>Ảnh thực tế</strong></div>
                        <div class="form-group mb-4">
                            <label for="imageUser-upload" class="input-tile mb-2">
                                <div class="d-flex">
                                    <a class="upload mr-2">Chọn ảnh</a>
                                    <div>(Tối đa 10, nếu có)</div>
                                </div>
                            </label>
                            <input id="imageUser-upload" type="file" multiple hidden />
                            <output class="d-flex flex-wrap" id="imageUser-preview">
                            </output>
                        </div>
                        <!-- Note -->
                        <div class="mb-2 text-primary"><strong>Ghi chú</strong></div>
                        <div class="form-group mb-4">
                            <input type="text" class="form-control pro-note" value="">
                        </div>
                        <!-- Link -->
                        <div class="mb-2 text-primary"><strong>Link</strong></div>
                        <div class="form-group mb-4">
                            <input type="text" class="form-control pro-link" value="">
                        </div>
                    </div>
                </div>
                <div class="text-center">
                    <button type="button" class="btn btn-secondary discard" onclick="history.back()">Quay lại</button>
                    <button type="button" class="btn btn-primary add-product">Lưu</button>
                </div>
            </form>
        </div>
    </div>
</div>
<script>
    // get brand 
    $(document).on('change', '.shop_select', function () {
        $.get('/ManageBrand/GetBrandsByShop', { id: $(this).val() })
            .then(function (response) {
                renderBrandForm(response);
            })
            .catch(function (error) {
                alert(error.responseText);
            })
    })
    // get subcategory
    $(document).on('change', '.brand_select', function () {
        $.get('/api/CategoryAPI/getSubCategoryByBrandId', { id: $(this).val() })
            .then(function (response) {
                renderSubCategoryForm(response);
            })
            .catch(function (error) {
                console.log(error);
                alert(error.responseText);
            })
    })
    // get attribute and options
    $(document).on('change', '.sub-category', function () {
        var _id = $(this).val()
        $.get('/api/CategoryAPI/getAttributesBySubCategoryId', { id: _id })
            .then(function (response) {
                renderAttributeForm(response);
            })
            .catch(function (error) {
                console.log(error);
            })
        $.get('/api/CategoryAPI/getBaseOptionsBySubCategoryId', { id: _id })
            .then(function (response) {
                renderOptionForm(response);
            })
            .catch(function (error) {
                console.log(error);
            })
    })

    function getSize(_id) {
        $.get('/api/ProductAPI/GetSizeGuideBySub', { id: _id })
            .then(function (response) {
                renderSize(response);
            })
            .catch(function (error) {
                console.log(error);
            })
    }

    // Upload file
    var arrFilesSystem = [];
    var arrFilesUser = [];
    loadIamgesWithPreview("imageProduct-upload", "imageProduct-preview", arrFilesSystem);
    loadIamgesWithPreview("imageUser-upload", "imageUser-preview", arrFilesUser);
    function loadIamgesWithPreview(upload, preview, arr) {
        if (window.File && window.FileList && window.FileReader) {
            var filesInput = document.getElementById(upload);
            filesInput.addEventListener("change", function (event) {
                var files = event.target.files; //FileList object
                var currentFiles = $('.image__upload-item').length + files.length
                if (currentFiles > 10) {
                    return;
                }
                var output = document.getElementById(preview);
                for (var i = 0; i < files.length; i++) {
                    var file = files[i];
                    //Only pics
                    if (!file.type.match('image'))
                        continue;

                    arr.push(file);

                    var picReader = new FileReader();
                    picReader.fileName = file.name;
                    picReader.addEventListener("load", function (event) {
                        var picFile = event.target;
                        var div = document.createElement("div");
                        div.classList.add(`image__upload-item`, `mr-2`);
                        div.innerHTML = `
                            <div class="border mb-2 mx-auto" style="height: 100px; width: 100px;">
                                <div class="image-wrapper w-100 h-100 position-relative d-flex align-items-center justify-content-center">
                                    <img class="mw-100 mh-100" src="${picFile.result}" alt="${picFile.name}">
                                    <span class="position-absolute remove-upload"
                                        style="right: 0; top: 0; cursor: pointer;">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="18"
                                            height="18" viewBox="0 0 24 24" fill="none"
                                            stroke="red" stroke-width="1" stroke-linecap="round"
                                            stroke-linejoin="round" class="feather feather-x">
                                            <line x1="18" y1="6" x2="6" y2="18"></line>
                                            <line x1="6" y1="6" x2="18" y2="18"></line>
                                        </svg>
                                    </span>
                                </div>
                            </div>
                        `;
                        var removeUpload = div.querySelector(".remove-upload");
                        removeUpload.addEventListener("click", function (evt) {
                            arr.forEach(function (file, index) {
                                if (file.name == event.target.fileName) {
                                    arr.splice(index, 1);
                                }
                            });
                            div.remove();
                            console.log(arr)
                        });
                        output.insertBefore(div, null);
                    });
                    //Read the image
                    picReader.readAsDataURL(file);
                }
            });
        }
    }

    // Add product
    $('.add-product').click(function () {
        // None relationship data
        var code = $(".pro-code").val();
        var name = $(".pro-name").val();
        var stock = $(".pro-stock").val();
        var description = tinymce.get("product-desciptions").getContent();
        var size = tinymce.get("product-sizeguide").getContent();
        var note = $(".pro-note").val();
        var link = $(".pro-link").val();
        var brandId = $("input[name='brand']:checked").val();
        var shopId = $("input[name='shop']:checked").val();
        var subCategoryId = $("input[name='subCategory']:checked").val();
        var isNew = $('.pro-new').is(":checked") ? true : false;
        var isLegit = $('.pro-legit').is(":checked") ? true : false;
        var isHighlight = $('.pro-highlight').is(":checked") ? true : false;
        var isFreeReturn = $('.pro-freereturn').is(":checked") ? true : false;
        var isFreeDelivery = $('.pro-freedelivery').is(":checked") ? true : false;
        var insurance = $(".pro-insurance").val();
        // Relationship data
        var attributes = [];
        $('.attribute-values').each(function (index, item) {
            var attributeId = $(this).attr("id");
            var attribute = {
                id: attributeId,
                value: $(this).val()
            }
            attributes.push(attribute);
        })
        var currentOptions = [];
        var newOptions = [];
        $('.option-values').each(function (index, item) {
            var optionId = $(this).attr("id");
            var newOption = {
                id: optionId,
                values: []
            }
            var values = item.children
            for (var i = 0; i < values.length; i++) {
                if (values[i].firstElementChild.attributes.id) {
                    var id = values[i].firstElementChild.attributes.id.value;
                    currentOptions.push(id);
                } else {
                    var value = values[i].firstElementChild.textContent;
                    newOption.values.push(value);
                }
            }
            newOptions.push(newOption);
        })

        var priceAvailable = {
            price: $(".pro-priceavailable").val(),
            priceOnSell: null,
        } // price type 1
        var pricePreorder = {
            price: $(".pro-pricepreorder").val(),
            priceOnSell: null,
        }  // price type 2
        if ($(".pro-disc-select").is(":checked")) {
            priceAvailable.priceOnSell = $(".pro-discavailable").val() ?? null;
            pricePreorder.priceOnSell = $(".pro-discpreorder").val() ?? null;
        }
        var discountPercent = null;
        if ($(".pro-discpercent-select").is(":checked")) {
            discountPercent = $(".pro-discpercent").val() ?? null;
        }

        var formData = new FormData();
        // None relationship data
        formData.append('code', code);
        formData.append('name', name);
        formData.append('stock', stock);
        formData.append('description', description);
        formData.append('size', size);
        formData.append('note', note);
        formData.append('link', link);
        formData.append('brandId', brandId);
        formData.append('subCategoryId', subCategoryId);
        formData.append('isNew', isNew);
        formData.append('isLegit', isLegit);
        formData.append('isHighlight', isHighlight);
        formData.append('isFreeReturn', isFreeReturn);
        formData.append('isFreeDelivery', isFreeDelivery);
        formData.append('insurance', insurance);
        formData.append('discountPercent', discountPercent);
        formData.append('shopId', shopId);
        // Relationship data
        formData.append('priceAvailable', JSON.stringify(priceAvailable));
        formData.append('pricePreorder', JSON.stringify(pricePreorder));
        formData.append('attributes', JSON.stringify(attributes));
        formData.append('currentOptions', JSON.stringify(currentOptions));
        formData.append('newOptions', JSON.stringify(newOptions));
        for (let i = 0; i < arrFilesSystem.length; i++) {
            formData.append('systemImage', arrFilesSystem[i]);
        };
        for (let i = 0; i < arrFilesUser.length; i++) {
            formData.append('userImage', arrFilesUser[i]);
        };

        $.ajax({
            type: "POST",
            url: "/ManageProduct/AddProduct",
            data: formData, //
            processData: false,
            contentType: false,
            success: function (response) {
                alert(response);
                window.location = "/ManageProduct/ProductList";
            },
            error: function (error) {
                console.log(error);
                alert(error.responseText);
            }
        });
    })

    // render data and html
    function renderBrandForm(list) {
        $('.brand-form').empty()
        $('.subcategory-form').empty();
        $('.attribute-form').empty();
        $('.option-form').empty();
        if (list.length) {
            $('.brand-form').append(htmlBrandForm());
            list.forEach(function (item) {
                $('.brand-list').append(htmlBrand(item.brandId, item.brandName));
            })
        }
    }
    function renderSubCategoryForm(list) {
        $('.subcategory-form').empty();
        $('.attribute-form').empty();
        $('.option-form').empty();
        if (list.length) {
            $('.subcategory-form').append(htmlSubCategoryForm());
            list.forEach(function (item) {
                $('.subcate-list').append(htmlSubCategory(item.subCategoryId, item.subCategoryName));
            })
        }
    }
    function renderAttributeForm(list) {
        $('.attribute-form').empty();
        if (list.length) {
            $('.attribute-form').append(htmlAttributeForm());
            list.forEach(function (item) {
                $('.attribute-list').append(htmlAttribute(item));
            })
        }
    }
    function renderOptionForm(list) {
        $('.option-form').empty();
        if (list.length) {
            $('.option-form').append(htmlOptionForm());
            list.forEach(function (item) {
                $('.option-list').append(htmlOption(item));
            })
        }
    }
    function renderSize(data) {
        tinymce.get("product-sizeguide").setContent(data.data.sizeContent);
    }

    // html
    function htmlBrandForm() {
        return `
            <label>Thương hiệu</label>
            <div class="dropdown mb-2 mr-2">
                <button class="btn border dropdown-toggle brand_select-text" type="button" data-toggle="dropdown">
                    Thương hiệu
                    <span class="caret"></span>
                </button>
                <ul class="dropdown-menu dropdown-br-menu px-2 brand-list" style="max-height: 300px; overflow: auto;">
                    <input class="form-control mb-2" id="myInput-br" type="text" placeholder="Tìm thương hiệu..." autocomplete="off"/>

                </ul>
            </div>
        `;
    }
    function htmlBrand(id, name) {
        return `
            <li class="d-flex align-items-center">
                <input name="brand" class="mr-2 brand_select" id="brand_${id}" type="radio" value="${id}">
                <label class="mb-0" for="brand_${id}">${name}</label>
            </li>
        `;
    }
    function htmlSubCategoryForm() {
        return `
            <label>Danh mục sản phẩm</label>
            <div class="dropdown mb-2 mr-2">
                <button class="btn border dropdown-toggle subcategory_select-text" type="button" data-toggle="dropdown">
                    Danh mục
                    <span class="caret"></span>
                </button>
                <ul class="dropdown-menu dropdown-sub-menu px-2 subcate-list" style="max-height: 300px; overflow: auto;">
                    <input class="form-control mb-2" id="myInput-sub" type="text" placeholder="Tìm danh mục.." autocomplete="off"/>

                </ul>
            </div>
        `;
    }
    function htmlSubCategory(id, name) {
        return `
            <li class="d-flex align-items-center">
                <input name="subCategory" class="mr-2 sub-category subcategory_select" id="attr_${id}" type="radio" value="${id}">
                <label class="mb-0" for="attr_${id}">${name}</label>
            </li>
        `;
    }
    function htmlOptionForm() {
        return `
            <div class="text-left mb-2 text-primary"><strong>Thông tin tùy chọn</strong></div>
            <div class="d-flex flex-wrap option-list">

            </div>
        `;
    }
    function htmlAttributeForm() {
        return `
            <div class="text-left mb-2 text-primary"><strong>Thông tin chi tiết</strong></div>
            <div class="d-flex flex-wrap attribute-list">

            </div>
        `;
    }
    function htmlOption(option) {
        var optionVal = '';
        $.ajax({
            url: '/ManageCategory/GetBaseOptionValue',
            type: 'POST',
            data: { id: option.id },
            async: false,
            success: function (data) {
                temp = data;
                data.forEach(item => {
                    optionVal += `
                        <li class="d-inline p-1 mr-2 mb-2"
                            style="background-color: #ddd; border-radius: 4px;">
                            <span class="text" id="${item.id}">${item.value}</span>
                            <span class="remove-tag ml-2" style="cursor: pointer;">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                    viewBox="0 0 24 24" fill="none" stroke="#333"
                                    stroke-width="1" stroke-linecap="round"
                                    stroke-linejoin="round" class="feather feather-x">
                                    <line x1="18" y1="6" x2="6" y2="18"></line>
                                    <line x1="6" y1="6" x2="18" y2="18"></line>
                                </svg>
                            </span>
                        </li>
                    `;
                });
            }
        });

        return `
            <div class="form-group mr-4 mb-2">
                <label>${option.name}</label>
                <div class="d-flex mb-2">
                    <div class="dropdown mr-2">
                        <input class="form-control" type="text">
                    </div>
                    <a class="add-option btn btn-primary">Thêm</a>
                </div>
                <ul class="pl-0 option-values" id="${option.id}">
                    ${optionVal}
                </ul>
            </div>
        `;
    }
    function htmlAttribute(attr) {
        return `
            <div class="form-group mr-2">
                <label>${attr.name}</label>
                <input type="text" class="form-control attribute-values" id="${attr.id}">
            </div>
        `;
    }
</script>
<script>
    tinymce.init({
        selector: 'textarea',
        plugins: 'image autolink lists media table',
        toolbar: 'addcomment showcomments code image pageembed permanentpen table tableofcontents',
        toolbar_mode: 'floating',
        tinycomments_mode: 'embedded',
        tinycomments_author: 'Author name',
    });
</script>
<script type="text/javascript">
    // Search input with autocomplete
    $(document).on("keyup", "#myInput-sh", function () {
        var value = $(this).val().toLowerCase();
        $(".dropdown-sh-menu li label").filter(function () {
            $(this).siblings("input").toggle($(this).text().toLowerCase().indexOf(value) > -1)
            $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
        });
    })
    $(document).on("keyup", "#myInput-br", function () {
        var value = $(this).val().toLowerCase();
        $(".dropdown-br-menu li label").filter(function () {
            $(this).siblings("input").toggle($(this).text().toLowerCase().indexOf(value) > -1)
            $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
        });
    })
    $(document).on("keyup", "#myInput-sub", function () {
        var value = $(this).val().toLowerCase();
        $(".dropdown-sub-menu li label").filter(function () {
            $(this).siblings("input").toggle($(this).text().toLowerCase().indexOf(value) > -1)
            $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
        });
    })
    $(document).on("keyup", "#myInput-size", function () {
        var value = $(this).val().toLowerCase();
        $(".dropdown-size-menu li label").filter(function () {
            $(this).siblings("input").toggle($(this).text().toLowerCase().indexOf(value) > -1)
            $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
        });
    })
</script>
<script type="text/javascript">
    $('.image-uploaded').change(function () {
        // Set image src
        let src = window.URL.createObjectURL(this.files[0]);
        $(this).siblings('.image-wrapper').children('img').attr('src', src);
        // hide label
        $(this).siblings('label').removeClass('d-flex');
        $(this).siblings('label').addClass('d-none');
        // display image
        $(this).siblings('.image-wrapper').removeClass('d-none');
        $(this).siblings('.image-wrapper').addClass('d-flex');
    })
    $('.remove-upload').click(function () {
        // Remove Image
        $(this).siblings('img').attr('src', '');
        // Hide image wrapper
        $(this).parent().removeClass('d-flex');
        $(this).parent().addClass('d-none');
        // Display label
        $(this).parent().siblings('label').removeClass('d-none');
        $(this).parent().siblings('label').addClass('d-flex');
    })
</script>
<script type="text/javascript">
    $(document).on('click', '.add-option', function () {
        let val = $(this).siblings('.dropdown').find('input').val();
        if (!val?.trim()) { return; }

        $(this).parent().siblings('ul').append(`
            <li class="d-inline p-1 mr-2 mb-2"
                style="background-color: #ddd; border-radius: 4px;">
                <span class="text">${val}</span>
                <span class="remove-tag ml-2" style="cursor: pointer;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                        viewBox="0 0 24 24" fill="none" stroke="#333"
                        stroke-width="1" stroke-linecap="round"
                        stroke-linejoin="round" class="feather feather-x">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </span>
            </li>
        `)

        $(this).siblings('.dropdown').find('input').val('');
    })
    $('.form-check-input').click(function () {
        if (this.previous) {
            this.checked = false;
        }
        this.previous = this.checked;
        if (!this.checked) {
            $(this).siblings('input').addClass('d-none');
        }
    })
    $('.form-check-input').change(function () {
        $('.form-check-input').siblings('input').addClass('d-none');
        if ($(this).is(':checked')) {
            $(this).siblings('input').removeClass('d-none');
        }
    })
</script>
<script type="text/javascript">
    // Remove current banner
    $('.remove-tag').click(function () {
        $(this).parent().remove();
    })
    // Remove new added banner
    $(document).on('click', ".remove-tag", function () {
        $(this).parent().remove();
    });
</script>
<script>
    $(document).on('click', '.brand_select', function () {
        var brandName = $(this).siblings('label').text();
        $('.brand_select-text').text(brandName);
    })
    $(document).on('click', '.shop_select', function () {
        var brandName = $(this).siblings('label').text();
        $('.shop_select-text').text(brandName);
    })
    $(document).on('click', '.subcategory_select', function () {
        var subcategoryName = $(this).siblings('label').text();
        $('.subcategory_select-text').text(subcategoryName);
    })
    $(document).on('click', '.size_select', function () {
        var name = $(this).siblings('label').text();
        $('.size_select-text').text(name);
    })
</script>